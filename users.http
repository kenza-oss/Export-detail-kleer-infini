### KleerLogistics Users API - Tests Complets
### Base URL: http://localhost:8000/api/v1/users/

### ========================================
### üîß CONFIGURATION INITIALE
### ========================================

### Variables d'environnement
@baseUrl = http://localhost:8000/api/v1/users
@contentType = application/json

### ========================================
### üîê AUTHENTIFICATION
### ========================================

### 1. Inscription d'un nouvel utilisateur
POST {{baseUrl}}/auth/register/
Content-Type: {{contentType}}

{
    "username": "romu",
    "email": "romu@example.com",
    "password": "TestPass123!",
    "password_confirm": "TestPass123!",
    "first_name": "Romu",
    "last_name": "User",
    "phone_number": "+21345875684",
    "role": "admin"
}

### 2. Connexion utilisateur
# @name login
POST {{baseUrl}}/auth/login/
Content-Type: {{contentType}}

{
    "identifier": "romu",
    "password": "TestPass123!"
}

### R√©cup√©rer le token apr√®s connexion
@authToken = {{login.response.body.tokens.access}}

### 3. Rafra√Æchissement du token
POST {{baseUrl}}/auth/token/refresh/
Content-Type: {{contentType}}

{
     "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NzEzLCJpYXQiOjE3NTQ3NzMxMTMsImp0aSI6IjZmZWNhNzBiZGRlNjRhOWM5MTkyZDBmNmM3ZjE3ZTU2IiwidXNlcl9pZCI6OCwidXNlcm5hbWUiOiJyb211Iiwicm9sZSI6ImFkbWluIiwiaXNfYWRtaW4iOnRydWV9.bHObYOiigp6LfMI3TdXS_vGF7rCL3qy1wvmuPcd4NL0",
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc1NDg1OTUxMywiaWF0IjoxNzU0NzczMTEzLCJqdGkiOiJkOTc3NTgxZGEyMGI0ZGZkYjFlZmE0YzE0MDBiNDM3NyIsInVzZXJfaWQiOiI4In0.h74lIE2CI33qe720PbngG_iKHX0o4VZUSD5H686Kqjs"
}

### 4. D√©connexion utilisateur
POST {{baseUrl}}/auth/logout/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "refresh": "{{login.response.body.tokens.refresh}}"
}

### ========================================
### üì± V√âRIFICATION OTP
### ========================================

### 5. Envoyer un OTP
POST {{baseUrl}}/auth/otp/send/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "phone_number": "+213550123456"
}

### 6. V√©rifier un OTP (remplacer par le code re√ßu)
POST {{baseUrl}}/auth/otp/verify/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "phone_number": "+213550123456",
    "code": "270918"
}

### ========================================
### üîë GESTION DES MOTS DE PASSE
### ========================================

### 7. Changer le mot de passe
POST {{baseUrl}}/auth/password/change/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "old_password": "TestPass123!",
    "new_password": "NewPass123!"
}

### 8. Demander une r√©initialisation
POST {{baseUrl}}/auth/password/reset/
Content-Type: {{contentType}}

{
    "email": "test@example.com"
}

### 9. Confirmer la r√©initialisation (remplacer uid/token)
POST {{baseUrl}}/auth/password/reset/confirm/
Content-Type: {{contentType}}

{
    "email": "test@example.com",
    "uid": "MQ",
    "token": "abc123-def456",
    "new_password": "ResetPass123!",
    "new_password_confirm": "ResetPass123!"
}

### ========================================
### üë§ PROFIL UTILISATEUR
### ========================================

### 10. R√©cup√©rer le profil
GET {{baseUrl}}/profile/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

### 11. Mettre √† jour le profil (PUT)
PUT {{baseUrl}}/profile/update/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "first_name": "Updated",
    "last_name": "Name",
    "phone_number": "+213550123456"
}

### 12. Mettre √† jour le profil (PATCH)
PATCH {{baseUrl}}/profile/update/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "first_name": "PartiallyUpdated"
}

### ========================================
### üìÑ GESTION DES DOCUMENTS
### ========================================

### 13. Lister les documents
GET {{baseUrl}}/documents/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

### 14. Uploader un document
POST {{baseUrl}}/documents/upload/
Content-Type: multipart/form-data; boundary=boundary
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

--boundary
Content-Disposition: form-data; name="document_type"; filename="id_card.pdf"
Content-Type: application/pdf

< ./id_card.pdf
--boundary--

### 15. R√©cup√©rer un document sp√©cifique
GET {{baseUrl}}/documents/1/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

### 16. Supprimer un document
DELETE {{baseUrl}}/documents/1/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

### ========================================
### ‚öôÔ∏è PR√âF√âRENCES ET STATUT
### ========================================

### 17. Mettre √† jour la langue
PUT {{baseUrl}}/preferences/language/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "preferred_language": "fr"
}

### 18. V√©rifier le statut
GET {{baseUrl}}/verification-status/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

### ========================================
### üë®‚Äçüíº FONCTIONNALIT√âS ADMIN
### ========================================

### 19. Lister tous les utilisateurs (admin)
GET {{baseUrl}}/admin/users/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NzM2LCJpYXQiOjE3NTQ3NzMxMzcsImp0aSI6IjBlY2I2YzRkMmQ4NDQxMzBiMGQzYTE0MTNkMTk2ZTkzIiwidXNlcl9pZCI6IjgifQ.G2SN7c4zf5PwSxFq-t1Dk8-yV9NzS442v9TKVgBZwYw

### 20. Mettre √† jour un r√¥le (admin)
PATCH {{baseUrl}}/admin/users/6/role/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NzM2LCJpYXQiOjE3NTQ3NzMxMzcsImp0aSI6IjBlY2I2YzRkMmQ4NDQxMzBiMGQzYTE0MTNkMTk2ZTkzIiwidXNlcl9pZCI6IjgifQ.G2SN7c4zf5PwSxFq-t1Dk8-yV9NzS442v9TKVgBZwYw

{
    "role": "traveler"
}

### ========================================
### üí∞ GESTION DU PORTEFEUILLE
### ========================================

### 21. Consulter le solde
GET {{baseUrl}}/wallet/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

### 22. Effectuer un d√©p√¥t
POST {{baseUrl}}/wallet/deposit/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NjQ5LCJpYXQiOjE3NTQ3NzMwNDksImp0aSI6IjkzNTM5ZTkzOWNkMzQ4ZTBiNGU0MTkxM2VjNzFhYmQ0IiwidXNlcl9pZCI6IjcifQ._-QTEVDotuIuODuubDHv-bYwZ0w9WXEv8NI1OG2CSsk

{
    "amount": 1000.00,
    "payment_method": "card"
}

### ========================================
### üß™ TESTS DE VALIDATION
### ========================================

### Test d'inscription invalide
POST {{baseUrl}}/auth/register/
Content-Type: {{contentType}}

{
    "username": "x",
    "email": "invalid",
    "password": "123",
    "password_confirm": "456"
}

### Test avec token invalide
GET {{baseUrl}}/profile/
Authorization: Bearer invalid_token

### ========================================
### üìã NOTES
### ========================================

### Pour utiliser ce fichier :
### 1. Installer l'extension REST Client pour VSCode
### 2. Configurer les variables :
###    - adminToken : Token JWT d'un admin
### 3. Ex√©cuter les requ√™tes dans l'ordre recommand√©
### 4. V√©rifier les codes de r√©ponse :
###    - 200 : Succ√®s
###    - 400: Erreur client
###    - 500 : Erreur serveur

### Workflow recommand√© :
### 1. Inscription
### 2. Connexion (r√©cup√©rer token)
### 3. Tester les endpoints prot√©g√©s
### 4. Pour les tests admin, utiliser un token admin valide
