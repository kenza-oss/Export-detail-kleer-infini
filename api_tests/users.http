### KleerLogistics Users API - Tests Complets avec S√©curit√© OTP Renforc√©e
### Base URL: http://localhost:8000/api/v1/users/

### ========================================
### üîß CONFIGURATION INITIALE
### ========================================

### Variables d'environnement
@baseUrl = http://localhost:8000/api/v1/users
@contentType = application/json

### ========================================
### üîê AUTHENTIFICATION
### ========================================

### 1. Inscription d'un nouvel utilisateur
POST {{baseUrl}}/auth/register/
Content-Type: {{contentType}}

{
    "username": "kenza",
    "email": "kenza@gmail.com",
    "password": "TestPass123!",
    "password_confirm": "TestPass123!",
    "first_name": "Kenza",
    "last_name": "User",
    "phone_number": "+213655451883",
    "role": "sender"
}

### 2. Connexion utilisateur
# @name login
POST {{baseUrl}}/auth/login/
Content-Type: {{contentType}}

{
    "identifier": "kenza",
    "password": "TestPass123!"
}

### R√©cup√©rer le token apr√®s connexion
@authToken = {{login.response.body.tokens.access}}

### 3. Rafra√Æchissement du token
POST {{baseUrl}}/auth/token/refresh/
Content-Type: {{contentType}}

{
    "access": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODU2LCJpYXQiOjE3NTUwMzMyNTYsImp0aSI6ImMzYzk1NjMyMWNhMDQxNWM5YmQzNWRiODEyMmIwYjQyIiwidXNlcl9pZCI6NCwidXNlcm5hbWUiOiJrZW56YSIsInJvbGUiOiJzZW5kZXIiLCJpc19hZG1pbiI6ZmFsc2V9.Jpi7SNZSFlIHJ8D66SaApXC7EEqcNcRXu53BtfkQN-w",
    "refresh": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoicmVmcmVzaCIsImV4cCI6MTc1NTExOTY1NiwiaWF0IjoxNzU1MDMzMjU2LCJqdGkiOiI1NWZmMjUyYTYxNmY0OTA1YjczOGFlN2FlZjUzNjMzMiIsInVzZXJfaWQiOiI0In0.ajwC-WnMNh4O3ovDKrv5FIlYeFbwOoHod8oIRa4AB9w"
}

### 4. D√©connexion utilisateur
POST {{baseUrl}}/auth/logout/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "refresh": "{{login.response.body.tokens.refresh}}"
}

### ========================================
### üì± V√âRIFICATION OTP - S√âCURIT√â RENFORC√âE
### ========================================

### 5. Envoyer un OTP (avec s√©curit√© renforc√©e)
POST {{baseUrl}}/auth/otp/send/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883"
}

### 6. V√©rifier un OTP (remplacer par le code re√ßu)
POST {{baseUrl}}/auth/otp/verify/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883",
    "code": "771687"
}

### 7. V√©rifier le statut de v√©rification du t√©l√©phone
GET {{baseUrl}}/auth/phone/status/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### ========================================
### üß™ TESTS DE S√âCURIT√â OTP AVANC√âS
### ========================================

### 8. Test de limitation de taux - Tentative multiple d'envoi OTP
### (Devrait √©chouer apr√®s 3 tentatives)
POST {{baseUrl}}/auth/otp/send/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883"
}

### 9. Test de v√©rification OTP avec code incorrect
### (Devrait √©chouer et incr√©menter le compteur de tentatives)
POST {{baseUrl}}/auth/otp/verify/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883",
    "code": "000000"
}

### 10. Test de v√©rification OTP avec num√©ro non v√©rifi√©
POST {{baseUrl}}/auth/otp/verify/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213999999999",
    "code": "123456"
}

### ========================================
### üîë GESTION DES MOTS DE PASSE
### ========================================

### 11. Changer le mot de passe
POST {{baseUrl}}/auth/password/change/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "old_password": "TestPass123!",
    "new_password": "NewPass123!"
}

### 12. Demander une r√©initialisation
POST {{baseUrl}}/auth/password/reset/
Content-Type: {{contentType}}

{
    "email": "test@example.com"
}

### 13. Confirmer la r√©initialisation (remplacer uid/token)
POST {{baseUrl}}/auth/password/reset/confirm/
Content-Type: {{contentType}}

{
    "email": "test@example.com",
    "uid": "MQ",
    "token": "abc123-def456",
    "new_password": "ResetPass123!",
    "new_password_confirm": "ResetPass123!"
}

### ========================================
### üë§ PROFIL UTILISATEUR
### ========================================

### 14. R√©cup√©rer le profil
GET {{baseUrl}}/profile/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 15. Mettre √† jour le profil (PUT)
PUT {{baseUrl}}/profile/update/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "first_name": "Updated",
    "last_name": "Name",
    "phone_number": "+213655451883"
}

### 16. Mettre √† jour le profil (PATCH)
PATCH {{baseUrl}}/profile/update/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "first_name": "PartiallyUpdated"
}

### ========================================
### üìÑ GESTION DES DOCUMENTS
### ========================================

### 17. Lister les documents
GET {{baseUrl}}/documents/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 18. Uploader un document
POST {{baseUrl}}/documents/upload/
Content-Type: multipart/form-data; boundary=boundary
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

--boundary
Content-Disposition: form-data; name="document_type"; filename="id_card.pdf"
Content-Type: application/pdf

< ./id_card.pdf
--boundary--

### 19. R√©cup√©rer un document sp√©cifique
GET {{baseUrl}}/documents/1/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 20. Supprimer un document
DELETE {{baseUrl}}/documents/1/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### ========================================
### ‚öôÔ∏è PR√âF√âRENCES ET STATUT
### ========================================

### 21. Mettre √† jour la langue
PUT {{baseUrl}}/preferences/language/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "preferred_language": "fr"
}

### 22. V√©rifier le statut de v√©rification
GET {{baseUrl}}/verification-status/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 23. Demander la v√©rification
POST {{baseUrl}}/request-verification/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 24. Consulter le statut complet de l'utilisateur
GET {{baseUrl}}/status/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### ========================================
### üë®‚Äçüíº FONCTIONNALIT√âS ADMIN
### ========================================

### 25. Lister tous les utilisateurs (admin)
GET {{baseUrl}}/admin/users/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NzM2LCJpYXQiOjE3NTQ3NzMxMzcsImp0aSI6IjBlY2I2YzRkMmQ4NDQxMzBiMGQzYTE0MTNkMTk2ZTkzIiwidXNlcl9pZCI6IjgifQ.G2SN7c4zf5PwSxFq-t1Dk8-yV9NzS442v9TKVgBZwYw

### 26. Mettre √† jour un r√¥le (admin)
PATCH {{baseUrl}}/admin/users/6/role/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU0Nzc2NzM2LCJpYXQiOjE3NTQ3NzMxMzcsImp0aSI6IjBlY2I2YzRkMmQ4NDQxMzBiMGQzYTE0MTNkMTk2ZTkzIiwidXNlcl9pZCI6IjgifQ.G2SN7c4zf5PwSxFq-t1Dk8-yV9NzS442v9TKVgBZwYw

{
    "role": "traveler"
}

### ========================================
### üí∞ GESTION DU PORTEFEUILLE (En cours)
### ========================================

### 27. Consulter le solde
GET {{baseUrl}}/wallet/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 28. Effectuer un d√©p√¥t
POST {{baseUrl}}/wallet/deposit/
Content-Type: {{contentType}}
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "amount": 1000.00,
    "payment_method": "card"
}

### ========================================
### üîç RECHERCHE ET ANALYTICS
### ========================================

### 29. Rechercher des utilisateurs
GET {{baseUrl}}/search/?q=romu
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 30. Consulter les analytics utilisateur
GET {{baseUrl}}/analytics/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 31. Consulter les performances utilisateur
GET {{baseUrl}}/performance/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### 32. Consulter les statistiques utilisateur
GET {{baseUrl}}/stats/
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

### ========================================
### üöÄ NOUVELLES FONCTIONNALIT√âS DE S√âCURIT√â
### ========================================

### 33. Test de fingerprinting d'appareil
### (Envoyer plusieurs requ√™tes avec le m√™me User-Agent pour tester la limitation par appareil)
POST {{baseUrl}}/auth/otp/send/
Content-Type: {{contentType}}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883"
}

### 34. Test de limitation de taux par appareil
### (Devrait √©chouer apr√®s 2 tentatives depuis le m√™me appareil)
POST {{baseUrl}}/auth/otp/send/
Content-Type: {{contentType}}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883"
}

### 35. Test de v√©rification OTP avec limitation par appareil
POST {{baseUrl}}/auth/otp/verify/
Content-Type: {{contentType}}
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ0b2tlbl90eXBlIjoiYWNjZXNzIiwiZXhwIjoxNzU1MDM2ODY5LCJpYXQiOjE3NTUwMzMyNzAsImp0aSI6ImMzNGRjMzAyNGRkNDRiZDM5NTc4MGZkOGI3NjlhMDlmIiwidXNlcl9pZCI6IjQifQ.sJGlnhlWFN5b6eBfOgAGAw3I14Z6SWY6-2jsyrRJ1-8

{
    "phone_number": "+213655451883",
    "code": "000000"
}

### ========================================
### üìã NOTES DE S√âCURIT√â
### ========================================

### üîí NOUVELLES FONCTIONNALIT√âS DE S√âCURIT√â OTP :

### 1. **Double Hachage** : Les codes OTP sont maintenant hach√©s deux fois avec HMAC-SHA256
### 2. **Salt Unique** : Chaque OTP a un salt unique bas√© sur le timestamp
### 3. **Fingerprinting d'Appareil** : Limitation de taux par appareil (User-Agent + Accept-Language + Accept-Encoding)
### 4. **Limitation de Taux Renforc√©e** : 
###    - 3 tentatives max par num√©ro de t√©l√©phone
###    - 2 tentatives max par appareil
###    - 5 tentatives max de v√©rification par num√©ro
###    - 3 tentatives max de v√©rification par appareil
### 5. **Nettoyage Automatique** : Suppression automatique des OTP expir√©s
### 6. **Audit Complet** : Logs d√©taill√©s de toutes les activit√©s OTP
### 7. **Protection contre le Spam** : Limitation du nombre d'OTP actifs par t√©l√©phone (max 3)

### üß™ TESTS DE S√âCURIT√â RECOMMAND√âS :

### 1. **Test de limitation de taux** : Envoyer 4 OTP au m√™me num√©ro (le 4√®me doit √©chouer)
### 2. **Test de limitation par appareil** : Envoyer 3 OTP depuis le m√™me User-Agent (le 3√®me doit √©chouer)
### 3. **Test de v√©rification multiple** : Essayer de v√©rifier un OTP 6 fois (le 6√®me doit √©chouer)
### 4. **Test de nettoyage** : V√©rifier que les OTP expir√©s sont automatiquement supprim√©s
### 5. **Test d'audit** : V√©rifier que tous les √©v√©nements sont logg√©s dans les logs

### ========================================
### üìã NOTES G√âN√âRALES
### ========================================

### Pour utiliser ce fichier :
### 1. Installer l'extension REST Client pour VSCode
### 2. Configurer les variables :
###    - adminToken : Token JWT d'un admin
### 3. Ex√©cuter les requ√™tes dans l'ordre recommand√©
### 4. V√©rifier les codes de r√©ponse :
###    - 200 : Succ√®s
###    - 400: Erreur client
###    - 500 : Erreur serveur

### Workflow recommand√© :
### 1. Inscription
### 2. Connexion (r√©cup√©rer token)
### 3. Tester les endpoints prot√©g√©s
### 4. Pour les tests admin, utiliser un token admin valide
### 5. Tester les nouvelles fonctionnalit√©s de s√©curit√© OTP
### 6. V√©rifier les logs de s√©curit√© dans la console Django
